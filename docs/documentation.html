<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation | Timefence</title>
    <meta name="description" content="Official documentation for Timefence. Temporal correctness layer for ML training data.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            900: '#14532d',
                            950: '#052e16',
                        },
                        dark: {
                            800: '#1e1e2e',
                            900: '#11111b',
                            950: '#0b0b12'
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }

        /* Sidebar */
        .sidebar-scroll::-webkit-scrollbar { width: 4px; }
        .sidebar-scroll::-webkit-scrollbar-track { background: transparent; }
        .sidebar-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
        .sidebar-scroll::-webkit-scrollbar-thumb:hover { background: #475569; }
        .sidebar-link.active { color: #4ade80; border-left-color: #4ade80; }

        /* Code blocks */
        pre[class*="language-"] { background-color: #1e1e2e !important; border: 1px solid rgba(255,255,255,0.1); border-radius: 0.5rem; margin: 1rem 0; position: relative; }
        code[class*="language-"] { font-size: 0.875rem; }
        :not(pre) > code { background: rgba(255,255,255,0.1); padding: 0.2em 0.4em; border-radius: 0.25rem; font-size: 0.875em; color: #e2e8f0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }

        /* Prose */
        .prose h2 { margin-top: 2.5rem; margin-bottom: 1rem; font-size: 1.5rem; font-weight: 700; color: #f8fafc; scroll-margin-top: 6rem; }
        .prose h3 { margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1.25rem; font-weight: 600; color: #e2e8f0; scroll-margin-top: 6rem; }
        .prose h4 { margin-top: 1.25rem; margin-bottom: 0.5rem; font-size: 1.1rem; font-weight: 600; color: #cbd5e1; scroll-margin-top: 6rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.75; color: #94a3b8; }
        .prose ul { margin-bottom: 1rem; list-style-type: disc; padding-left: 1.5rem; color: #94a3b8; }
        .prose ol { margin-bottom: 1rem; list-style-type: decimal; padding-left: 1.5rem; color: #94a3b8; }
        .prose li { margin-bottom: 0.5rem; }
        .prose strong { color: #f1f5f9; font-weight: 600; }
        .prose blockquote { border-left: 4px solid #22c55e; background: rgba(34, 197, 94, 0.05); padding: 1rem 1.25rem; margin: 1rem 0; border-radius: 0 0.5rem 0.5rem 0; }
        .prose blockquote p { margin-bottom: 0; color: #a7f3d0; }
        .prose hr { border-color: rgba(255,255,255,0.1); margin: 2rem 0; }

        /* API cards */
        .api-card { border-left: 4px solid #22c55e; background: rgba(255,255,255,0.02); padding: 1.5rem; margin-bottom: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; }
        .api-card-blue { border-left-color: #3b82f6; }
        .api-card-amber { border-left-color: #f59e0b; }
        .api-card-red { border-left-color: #ef4444; }
        .param-table td { padding: 0.5rem 1rem 0.5rem 0; vertical-align: top; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .param-table tr:last-child td { border-bottom: none; }
        .param-name { color: #4ade80; font-family: monospace; font-weight: 600; white-space: nowrap; }
        .param-type { color: #94a3b8; font-family: monospace; font-size: 0.85em; white-space: nowrap; }
        .param-default { color: #64748b; font-family: monospace; font-size: 0.85em; }

        /* Copy button */
        .copy-btn { position: absolute; top: 0.5rem; right: 0.5rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; background: rgba(255,255,255,0.1); color: #94a3b8; font-size: 0.75rem; cursor: pointer; border: none; opacity: 0; transition: opacity 0.2s; }
        pre:hover .copy-btn { opacity: 1; }
        .copy-btn:hover { background: rgba(255,255,255,0.2); color: #e2e8f0; }

        /* Callouts */
        .callout-info { border-left: 4px solid #3b82f6; background: rgba(59, 130, 246, 0.05); padding: 1rem 1.25rem; margin: 1rem 0; border-radius: 0 0.5rem 0.5rem 0; }
        .callout-warn { border-left: 4px solid #f59e0b; background: rgba(245, 158, 11, 0.05); padding: 1rem 1.25rem; margin: 1rem 0; border-radius: 0 0.5rem 0.5rem 0; }
        .callout-tip { border-left: 4px solid #22c55e; background: rgba(34, 197, 94, 0.05); padding: 1rem 1.25rem; margin: 1rem 0; border-radius: 0 0.5rem 0.5rem 0; }

        /* Back to top */
        #back-to-top { transition: opacity 0.3s, transform 0.3s; }
    </style>
</head>
<body class="bg-dark-950 text-slate-300 antialiased">

    <!-- Header -->
    <nav class="fixed w-full z-50 backdrop-blur-md bg-dark-950/90 border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-2">
                    <a href="index.html" class="flex items-center gap-2 group">
                        <div class="w-8 h-8 rounded bg-gradient-to-br from-brand-400 to-brand-600 flex items-center justify-center text-dark-950 font-bold font-mono text-lg group-hover:scale-105 transition-transform">T</div>
                        <span class="font-bold text-white tracking-tight">timefence</span>
                    </a>
                    <span class="px-2 py-0.5 rounded text-xs bg-white/10 text-slate-400 border border-white/5">Docs</span>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Mobile menu button -->
                    <button onclick="document.getElementById('mobile-sidebar').classList.toggle('hidden')" class="lg:hidden inline-flex items-center justify-center p-2 rounded-md text-slate-400 hover:text-white hover:bg-white/10">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                    </button>
                    <a href="https://github.com/gauthierpiarrette/timefence" class="text-slate-400 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Sidebar Overlay -->
    <div id="mobile-sidebar" class="hidden fixed inset-0 z-40 lg:hidden">
        <div class="fixed inset-0 bg-black/60" onclick="document.getElementById('mobile-sidebar').classList.add('hidden')"></div>
        <div class="fixed top-0 left-0 w-72 h-full bg-dark-950 border-r border-white/10 overflow-y-auto sidebar-scroll pt-20 pb-10 px-6 z-50">
            <nav class="space-y-6" id="mobile-nav"></nav>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16">
        <div class="flex">
            <!-- Sidebar -->
            <aside class="w-64 fixed h-[calc(100vh-4rem)] overflow-y-auto sidebar-scroll hidden lg:block pt-8 pb-10 pr-6 border-r border-white/5">
                <nav class="space-y-6" id="desktop-nav">
                    <div>
                        <h5 class="mb-3 font-semibold text-white tracking-wide text-sm uppercase">Getting Started</h5>
                        <ul class="space-y-1 text-sm border-l border-white/10 ml-1">
                            <li><a href="#introduction" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Introduction</a></li>
                            <li><a href="#installation" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Installation</a></li>
                            <li><a href="#quickstart" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Quickstart</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="mb-3 font-semibold text-white tracking-wide text-sm uppercase">Core Concepts</h5>
                        <ul class="space-y-1 text-sm border-l border-white/10 ml-1">
                            <li><a href="#correctness" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Temporal Correctness</a></li>
                            <li><a href="#embargo" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Embargo</a></li>
                            <li><a href="#join-logic" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Join Logic</a></li>
                            <li><a href="#splits" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Time-Based Splits</a></li>
                            <li><a href="#caching" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Caching &amp; Store</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="mb-3 font-semibold text-white tracking-wide text-sm uppercase">Guides</h5>
                        <ul class="space-y-1 text-sm border-l border-white/10 ml-1">
                            <li><a href="#guide-audit" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Audit Existing Data</a></li>
                            <li><a href="#guide-build" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Build from Scratch</a></li>
                            <li><a href="#guide-ci" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">CI/CD Integration</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="mb-3 font-semibold text-white tracking-wide text-sm uppercase">Python API</h5>
                        <ul class="space-y-1 text-sm border-l border-white/10 ml-1">
                            <li><a href="#api-source" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Source</a></li>
                            <li><a href="#api-feature" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Feature</a></li>
                            <li><a href="#api-labels" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Labels</a></li>
                            <li><a href="#api-featureset" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">FeatureSet</a></li>
                            <li><a href="#api-build" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">build()</a></li>
                            <li><a href="#api-audit" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">audit()</a></li>
                            <li><a href="#api-explain" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">explain()</a></li>
                            <li><a href="#api-diff" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">diff()</a></li>
                            <li><a href="#api-store" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Store</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="mb-3 font-semibold text-white tracking-wide text-sm uppercase">CLI Reference</h5>
                        <ul class="space-y-1 text-sm border-l border-white/10 ml-1">
                            <li><a href="#cli-audit" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">audit</a></li>
                            <li><a href="#cli-build" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">build</a></li>
                            <li><a href="#cli-explain" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">explain</a></li>
                            <li><a href="#cli-diff" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">diff</a></li>
                            <li><a href="#cli-inspect" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">inspect</a></li>
                            <li><a href="#cli-quickstart" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">quickstart</a></li>
                            <li><a href="#cli-catalog" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">catalog</a></li>
                            <li><a href="#cli-doctor" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">doctor</a></li>
                            <li><a href="#cli-init" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">init</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="mb-3 font-semibold text-white tracking-wide text-sm uppercase">Reference</h5>
                        <ul class="space-y-1 text-sm border-l border-white/10 ml-1">
                            <li><a href="#config" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Configuration</a></li>
                            <li><a href="#errors" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Errors</a></li>
                            <li><a href="#durations" class="sidebar-link block pl-4 py-1 text-slate-400 hover:text-brand-400 border-l-2 border-transparent -ml-px transition-colors">Duration Format</a></li>
                        </ul>
                    </div>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 lg:pl-72 py-10 max-w-4xl prose prose-invert">

                <!-- ============================================================ -->
                <!-- GETTING STARTED                                              -->
                <!-- ============================================================ -->

                <section id="introduction">
                    <h1 class="text-4xl font-bold text-white mb-2">Documentation</h1>
                    <p class="text-sm text-slate-500 mb-6">Timefence v0.9.0</p>
                    <p class="text-lg text-slate-300">
                        Timefence is a temporal correctness layer for ML training data. It guarantees that no future data leaks into your training set by enforcing point-in-time correctness at the moment of dataset construction.
                    </p>
                    <p>
                        It is <strong>not</strong> a feature store, data orchestrator, data quality framework, or ML pipeline.
                        Timefence does one thing: ensures <code>feature_time &lt; label_time</code> for every row.
                    </p>
                </section>

                <section id="installation">
                    <h2>Installation</h2>
                    <p>Timefence requires <strong>Python 3.9+</strong> and pip.</p>
                    <pre><code class="language-bash">pip install timefence</code></pre>
                    <p>Optional extras:</p>
                    <pre><code class="language-bash"># Jupyter notebook support
pip install timefence[notebook]

# Development dependencies
pip install timefence[dev]</code></pre>
                    <p><strong>Dependencies:</strong> <code>duckdb&gt;=1.0.0</code>, <code>click&gt;=8.0.0</code>, <code>rich&gt;=13.0.0</code>, <code>pandas&gt;=1.5.0</code>. No Spark, no cloud infrastructure.</p>
                </section>

                <section id="quickstart">
                    <h2>Quickstart</h2>
                    <p>Generate a complete example project with synthetic data and planted leakage scenarios:</p>
                    <pre><code class="language-bash">timefence quickstart churn-example
cd churn-example</code></pre>
                    <p>This creates a self-contained directory with:</p>
                    <ul>
                        <li><code>timefence.yaml</code> &mdash; Project configuration</li>
                        <li><code>features.py</code> &mdash; 4 feature definitions</li>
                        <li><code>data/</code> &mdash; Synthetic parquet files (users, transactions, labels)</li>
                        <li><code>data/train_LEAKY.parquet</code> &mdash; Pre-built dataset with planted leakage</li>
                        <li><code>README.md</code> &mdash; Next-step instructions</li>
                    </ul>
                    <p>Now audit the leaky dataset:</p>
                    <pre><code class="language-bash">timefence audit data/train_LEAKY.parquet</code></pre>
                    <p>Then build a clean one:</p>
                    <pre><code class="language-bash">timefence build -o train_CLEAN.parquet</code></pre>
                </section>

                <hr>

                <!-- ============================================================ -->
                <!-- CORE CONCEPTS                                                -->
                <!-- ============================================================ -->

                <section id="correctness">
                    <h2>Temporal Correctness</h2>
                    <p>The core invariant Timefence enforces is:</p>
                    <blockquote><p><code>feature_time &lt; label_time - embargo</code></p></blockquote>
                    <p>
                        For every row in your training set, the feature value used must have been available
                        <em>strictly before</em> the label event time (minus any embargo buffer). This prevents
                        future data leakage &mdash; the most common and hardest-to-detect source of inflated ML metrics.
                    </p>
                    <p>In <code>inclusive</code> join mode, the condition relaxes to:</p>
                    <blockquote><p><code>feature_time &lt;= label_time - embargo</code></p></blockquote>
                </section>

                <section id="embargo">
                    <h2>Embargo</h2>
                    <p>
                        Real-world ML pipelines have latency: data arrives late, ETL jobs run on schedules, and features
                        take time to compute. The <strong>embargo</strong> parameter models this lag.
                    </p>
                    <pre><code class="language-python">rolling_spend = timefence.Feature(
    source=transactions,
    sql="SELECT ...",
    embargo="1d"  # Feature available 1 day after event
)</code></pre>
                    <p>With <code>embargo="1d"</code>, a feature recorded at <code>2024-03-15 10:00</code> is only eligible for labels at <code>2024-03-16 10:00</code> or later. This prevents optimistic leakage from features that wouldn't actually be available in production.</p>
                    <p>Accepted formats: <code>"30d"</code>, <code>"1d12h"</code>, <code>"6h"</code>, <code>"30m"</code>, <code>"15s"</code>. See <a href="#durations" class="text-brand-400 hover:underline">Duration Format</a>.</p>
                </section>

                <section id="join-logic">
                    <h2>Join Logic</h2>
                    <p>Timefence performs an <strong>as-of join</strong> (also called a point-in-time join) for each feature. For each label row, it finds the most recent feature value that satisfies the temporal constraint.</p>
                    <p>Two modes are available:</p>
                    <table class="w-full text-sm mb-4">
                        <thead><tr><th class="text-left text-slate-400 pb-2">Mode</th><th class="text-left text-slate-400 pb-2">Condition</th><th class="text-left text-slate-400 pb-2">Use When</th></tr></thead>
                        <tbody>
                            <tr><td class="py-1"><code>"strict"</code></td><td class="py-1"><code>feature_time &lt; label_time</code></td><td class="py-1 text-slate-400">Default. No same-timestamp leakage.</td></tr>
                            <tr><td class="py-1"><code>"inclusive"</code></td><td class="py-1"><code>feature_time &lt;= label_time</code></td><td class="py-1 text-slate-400">When same-timestamp is safe (e.g., static attributes).</td></tr>
                        </tbody>
                    </table>
                    <p>Additional constraints:</p>
                    <ul>
                        <li><code>max_lookback</code> &mdash; Maximum age of a feature value (default: <code>"365d"</code>). Features older than this are treated as missing.</li>
                        <li><code>max_staleness</code> &mdash; If set, features older than this threshold are treated as missing even if within the lookback window. Must satisfy: <code>max_lookback &gt;= max_staleness &gt; embargo</code>.</li>
                    </ul>
                </section>

                <section id="splits">
                    <h2>Time-Based Splits</h2>
                    <p>Build separate train/validation/test files split by label time:</p>
                    <pre><code class="language-python">result = timefence.build(
    labels=labels,
    features=[rolling_spend, user_country],
    output="dataset.parquet",
    splits={
        "train": ("2023-01-01", "2024-01-01"),
        "valid": ("2024-01-01", "2024-07-01"),
        "test":  ("2024-07-01", "2025-01-01"),
    },
)

# result.splits = {"train": Path(...), "valid": Path(...), "test": Path(...)}</code></pre>
                    <p>Each split file contains only labels whose <code>label_time</code> falls within the given range. All temporal correctness guarantees still apply per-row.</p>
                </section>

                <section id="caching">
                    <h2>Caching &amp; Store</h2>
                    <p>Timefence can track builds and cache intermediate results using a local <code>Store</code>:</p>
                    <pre><code class="language-python">store = timefence.Store(".timefence")

result = timefence.build(
    labels=labels,
    features=[rolling_spend],
    output="train.parquet",
    store=store,
)</code></pre>
                    <p>Cache keys are computed from content hashes of source files, feature definitions, and build parameters. If nothing has changed, subsequent builds return cached results in milliseconds.</p>
                </section>

                <hr>

                <!-- ============================================================ -->
                <!-- GUIDES                                                       -->
                <!-- ============================================================ -->

                <section id="guide-audit">
                    <h2>Guide: Audit Existing Data</h2>
                    <p>Already have a training dataset? Audit it for temporal leakage without rebuilding.</p>
                    <h4>Step 1: Inspect your data</h4>
                    <pre><code class="language-bash">timefence inspect data/train.parquet</code></pre>
                    <p>This shows column types and suggests which columns are likely keys and timestamps.</p>
                    <h4>Step 2: Run the audit</h4>
                    <pre><code class="language-python">import timefence

transactions = timefence.Source(
    path="data/transactions.parquet",
    keys=["user_id"],
    timestamp="created_at",
)

rolling_spend = timefence.Feature(
    source=transactions,
    columns=["amount"],
    embargo="1d",
)

report = timefence.audit(
    data="data/train.parquet",
    features=[rolling_spend],
    keys=["user_id"],
    label_time="label_time",
)

print(report)
# Per-feature breakdown: clean/leaky row counts, severity, max leakage</code></pre>
                    <h4>Step 3: Inspect results</h4>
                    <pre><code class="language-python"># Check overall status
report.has_leakage        # True/False
report.leaky_features     # ["rolling_spend_30d"]
report.clean_features     # ["user_country"]

# Per-feature details
detail = report["rolling_spend_30d"]
detail.leaky_row_count    # 1520
detail.leaky_row_pct      # 0.304
detail.severity           # "HIGH"
detail.max_leakage        # timedelta(days=15)

# Export
report.to_html("audit_report.html")
report.to_json("audit_report.json")</code></pre>
                </section>

                <section id="guide-build">
                    <h2>Guide: Build from Scratch</h2>
                    <p>Build a point-in-time correct training dataset from raw data.</p>
                    <pre><code class="language-python">import timefence

# 1. Define sources
transactions = timefence.Source(
    path="data/transactions.parquet",
    keys=["user_id"],
    timestamp="created_at",
)

users = timefence.Source(
    path="data/users.parquet",
    keys=["user_id"],
    timestamp="updated_at",
)

# 2. Define features
rolling_spend = timefence.Feature(
    source=transactions,
    sql="""
        SELECT user_id, created_at,
        SUM(amount) OVER (
            PARTITION BY user_id
            ORDER BY created_at
            RANGE INTERVAL 30 DAYS PRECEDING
        ) AS spend_30d
        FROM {source}
    """,
    name="rolling_spend_30d",
    embargo="1d",
)

user_country = timefence.Feature(
    source=users,
    columns=["country"],
)

# 3. Define labels
labels = timefence.Labels(
    path="data/labels.parquet",
    keys=["user_id"],
    label_time="label_time",
    target="churned",
)

# 4. Build
result = timefence.build(
    labels=labels,
    features=[rolling_spend, user_country],
    output="train_CLEAN.parquet",
)

print(result)
# rows: 5000, columns: 4, duration: 0.8s</code></pre>
                </section>

                <section id="guide-ci">
                    <h2>Guide: CI/CD Integration</h2>
                    <p>Add temporal correctness checks to your CI pipeline.</p>
                    <h4>Using the CLI</h4>
                    <pre><code class="language-bash"># Exits with code 1 if leakage is found
timefence audit data/train.parquet --strict</code></pre>
                    <h4>Using Python</h4>
                    <pre><code class="language-python">report = timefence.audit(
    data="data/train.parquet",
    features=[rolling_spend, user_country],
    keys=["user_id"],
    label_time="label_time",
)

# Raises TimefenceLeakageError if any leakage detected
report.assert_clean()</code></pre>
                    <h4>GitHub Actions example</h4>
                    <pre><code class="language-yaml">- name: Audit training data
  run: |
    pip install timefence
    timefence audit data/train.parquet \
      --features features.py \
      --keys user_id \
      --label-time label_time \
      --strict</code></pre>
                </section>

                <hr>

                <!-- ============================================================ -->
                <!-- PYTHON API REFERENCE                                         -->
                <!-- ============================================================ -->

                <section id="api">
                    <h2 class="border-b border-white/10 pb-2 mb-8">Python API Reference</h2>

                    <!-- Source -->
                    <div id="api-source" class="api-card">
                        <h3 class="text-xl font-mono text-white mt-0">class Source</h3>
                        <p>Defines a historical data source (Parquet, CSV, or DataFrame).</p>
                        <pre><code class="language-python">timefence.Source(
    path=None,
    *,
    keys,
    timestamp,
    name=None,
    format=None,
    delimiter=",",
    timestamp_format=None,
    df=None,
)</code></pre>
                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">path</td>
                                <td class="param-type">str | Path | None</td>
                                <td>Path to the data file. Mutually exclusive with <code>df</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">keys</td>
                                <td class="param-type">str | list[str]</td>
                                <td>Column name(s) representing the entity (e.g., <code>"user_id"</code>).</td>
                            </tr>
                            <tr>
                                <td class="param-name">timestamp</td>
                                <td class="param-type">str</td>
                                <td>Column name containing the valid-at timestamp.</td>
                            </tr>
                            <tr>
                                <td class="param-name">name</td>
                                <td class="param-type">str | None</td>
                                <td>Human-readable name. Defaults to filename stem.</td>
                            </tr>
                            <tr>
                                <td class="param-name">format</td>
                                <td class="param-type">str | None</td>
                                <td><code>"parquet"</code> or <code>"csv"</code>. Auto-detected from file extension.</td>
                            </tr>
                            <tr>
                                <td class="param-name">delimiter</td>
                                <td class="param-type">str</td>
                                <td>CSV delimiter. Default: <code>","</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">timestamp_format</td>
                                <td class="param-type">str | None</td>
                                <td>Optional strftime format for parsing timestamps (CSV only).</td>
                            </tr>
                            <tr>
                                <td class="param-name">df</td>
                                <td class="param-type">DataFrame | None</td>
                                <td>Pass a DataFrame directly instead of a file path. Mutually exclusive with <code>path</code>.</td>
                            </tr>
                        </table>

                        <h4>Convenience aliases</h4>
                        <pre><code class="language-python"># Explicit format selection
transactions = timefence.ParquetSource("data/tx.parquet", keys="user_id", timestamp="ts")
events = timefence.CSVSource("data/events.csv", keys="user_id", timestamp="ts")</code></pre>

                        <h4>SQLSource</h4>
                        <p>Define a source via a SQL query against DuckDB:</p>
                        <pre><code class="language-python">source = timefence.SQLSource(
    query="SELECT * FROM read_parquet('data/*.parquet')",
    keys="user_id",
    timestamp="created_at",
    name="all_transactions",
    connection=None,  # Optional: DuckDB database path
)</code></pre>
                    </div>

                    <!-- Feature -->
                    <div id="api-feature" class="api-card">
                        <h3 class="text-xl font-mono text-white mt-0">class Feature</h3>
                        <p>A named signal derived from a Source. Exactly one of <code>columns</code>, <code>sql</code>, or <code>transform</code> must be provided.</p>
                        <pre><code class="language-python">timefence.Feature(
    source,
    *,
    columns=None,
    sql=None,
    transform=None,
    name=None,
    embargo=None,
    key_mapping=None,
    on_duplicate="error",
)</code></pre>
                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">source</td>
                                <td class="param-type">Source | SQLSource</td>
                                <td>The data source object.</td>
                            </tr>
                            <tr>
                                <td class="param-name">columns</td>
                                <td class="param-type">str | list | dict | None</td>
                                <td><strong>Mode 1:</strong> Select columns directly. Pass a dict to rename: <code>{"source_col": "feature_col"}</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">sql</td>
                                <td class="param-type">str | Path | None</td>
                                <td><strong>Mode 2:</strong> SQL query or path to <code>.sql</code> file. Use <code>{source}</code> placeholder for the source table.</td>
                            </tr>
                            <tr>
                                <td class="param-name">transform</td>
                                <td class="param-type">Callable | None</td>
                                <td><strong>Mode 3:</strong> Python function <code>(conn, source_table) -&gt; DataFrame</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">name</td>
                                <td class="param-type">str | None</td>
                                <td>Feature name. Auto-derived from columns, filename, or function name when possible. Required for inline SQL strings.</td>
                            </tr>
                            <tr>
                                <td class="param-name">embargo</td>
                                <td class="param-type">str | timedelta | None</td>
                                <td>Computation lag buffer (e.g., <code>"1d"</code>, <code>"12h"</code>). See <a href="#embargo" class="text-brand-400 hover:underline">Embargo</a>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">key_mapping</td>
                                <td class="param-type">dict[str, str] | None</td>
                                <td>Map label key names to source key names: <code>{"user_id": "customer_id"}</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">on_duplicate</td>
                                <td class="param-type">str</td>
                                <td><code>"error"</code> (default, raises) or <code>"keep_any"</code> (silently keeps one row) when duplicate <code>(key, feature_time)</code> pairs exist.</td>
                            </tr>
                        </table>

                        <h4>Feature modes</h4>
                        <pre><code class="language-python"># Mode 1: Column selection
country = timefence.Feature(source=users, columns=["country"])

# Mode 2: SQL (inline)
spend = timefence.Feature(
    source=transactions,
    sql="""
        SELECT user_id, created_at,
        SUM(amount) OVER (
            PARTITION BY user_id ORDER BY created_at
            RANGE INTERVAL 30 DAYS PRECEDING
        ) AS spend_30d
        FROM {source}
    """,
    name="rolling_spend_30d",
    embargo="1d",
)

# Mode 2: SQL (file)
spend = timefence.Feature(
    source=transactions,
    sql=Path("features/rolling_spend.sql"),
)

# Mode 3: Python transform
def compute_score(conn, source_table):
    return conn.sql(f"""
        SELECT user_id, created_at AS feature_time,
               raw_score * 2.5 AS adjusted_score
        FROM {source_table}
    """)

score = timefence.Feature(source=transactions, transform=compute_score)</code></pre>
                    </div>

                    <!-- Labels -->
                    <div id="api-labels" class="api-card">
                        <h3 class="text-xl font-mono text-white mt-0">class Labels</h3>
                        <p>Defines the prediction target: which entities, at what times, and what outcome.</p>
                        <pre><code class="language-python">timefence.Labels(
    *,
    path=None,
    df=None,
    keys,
    label_time,
    target,
)</code></pre>
                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">path</td>
                                <td class="param-type">str | Path | None</td>
                                <td>Path to labels file (Parquet). Mutually exclusive with <code>df</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">df</td>
                                <td class="param-type">DataFrame | None</td>
                                <td>DataFrame with labels. Mutually exclusive with <code>path</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">keys</td>
                                <td class="param-type">str | list[str]</td>
                                <td>Entity key column(s). Must match the keys used in features.</td>
                            </tr>
                            <tr>
                                <td class="param-name">label_time</td>
                                <td class="param-type">str</td>
                                <td>Column name for the label event timestamp.</td>
                            </tr>
                            <tr>
                                <td class="param-name">target</td>
                                <td class="param-type">str | list[str]</td>
                                <td>Prediction target column(s) (e.g., <code>"churned"</code>).</td>
                            </tr>
                        </table>
                        <pre><code class="language-python">labels = timefence.Labels(
    path="data/labels.parquet",
    keys=["user_id"],
    label_time="label_time",
    target="churned",
)</code></pre>
                    </div>

                    <!-- FeatureSet -->
                    <div id="api-featureset" class="api-card">
                        <h3 class="text-xl font-mono text-white mt-0">class FeatureSet</h3>
                        <p>Group features for reuse across builds and audits.</p>
                        <pre><code class="language-python">base_features = timefence.FeatureSet(
    name="churn_features_v1",
    features=[rolling_spend, user_country, login_count],
)

# Use in build/audit like individual features
result = timefence.build(
    labels=labels,
    features=[base_features, new_experimental_feature],
    output="train.parquet",
)</code></pre>
                        <p>Supports iteration (<code>for f in feature_set</code>) and <code>len()</code>.</p>
                    </div>

                    <!-- build() -->
                    <div id="api-build" class="api-card">
                        <h3 class="text-xl font-mono text-white mt-0">function build()</h3>
                        <p>Constructs a point-in-time correct training dataset.</p>
                        <pre><code class="language-python">timefence.build(
    labels,
    features,
    output=None,
    *,
    max_lookback="365d",
    max_staleness=None,
    join="strict",
    on_missing="null",
    splits=None,
    store=None,
    flatten_columns=False,
    progress=None,
) -> BuildResult</code></pre>
                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">labels</td>
                                <td class="param-type">Labels</td>
                                <td>Label definition.</td>
                            </tr>
                            <tr>
                                <td class="param-name">features</td>
                                <td class="param-type">list[Feature | FeatureSet]</td>
                                <td>Features to join.</td>
                            </tr>
                            <tr>
                                <td class="param-name">output</td>
                                <td class="param-type">str | Path | None</td>
                                <td>Output file path. If <code>None</code>, no file is written (result available in memory).</td>
                            </tr>
                            <tr>
                                <td class="param-name">max_lookback</td>
                                <td class="param-type">str | timedelta</td>
                                <td>Maximum feature age. Default: <code>"365d"</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">max_staleness</td>
                                <td class="param-type">str | timedelta | None</td>
                                <td>Max feature age before treating as missing. Must satisfy <code>max_lookback &gt;= max_staleness &gt; embargo</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">join</td>
                                <td class="param-type">str</td>
                                <td><code>"strict"</code> (<code>&lt;</code>) or <code>"inclusive"</code> (<code>&lt;=</code>). Default: <code>"strict"</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">on_missing</td>
                                <td class="param-type">str</td>
                                <td><code>"null"</code> (keep row with NULLs) or <code>"skip"</code> (drop row). Default: <code>"null"</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">splits</td>
                                <td class="param-type">dict | None</td>
                                <td>Time-based splits: <code>{"train": ("start", "end"), ...}</code>. See <a href="#splits" class="text-brand-400 hover:underline">Splits</a>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">store</td>
                                <td class="param-type">Store | None</td>
                                <td>Build tracking and caching. Pass a <code>Store</code> instance. See <a href="#api-store" class="text-brand-400 hover:underline">Store</a>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">flatten_columns</td>
                                <td class="param-type">bool</td>
                                <td>Strip feature name prefix from output columns. Default: <code>False</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">progress</td>
                                <td class="param-type">Callable | None</td>
                                <td>Callback invoked with a status message at each step. Useful for progress bars. Default: <code>None</code>.</td>
                            </tr>
                        </table>

                        <h4>Returns: BuildResult</h4>
                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">.output_path</td>
                                <td class="param-type">str | None</td>
                                <td>Path to the output file.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.stats</td>
                                <td class="param-type">BuildStats</td>
                                <td><code>.row_count</code>, <code>.column_count</code>, <code>.feature_stats</code> (matched/missing/cached counts), <code>.duration_seconds</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.sql</td>
                                <td class="param-type">str</td>
                                <td>The exact SQL query executed.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.splits</td>
                                <td class="param-type">dict[str, Path] | None</td>
                                <td>Split output file paths (when <code>splits</code> was provided).</td>
                            </tr>
                            <tr>
                                <td class="param-name">.manifest</td>
                                <td class="param-type">dict</td>
                                <td>Full build manifest (JSON-serializable).</td>
                            </tr>
                            <tr>
                                <td class="param-name">.validate()</td>
                                <td class="param-type">bool</td>
                                <td>Re-run audit on the output to verify correctness.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.explain()</td>
                                <td class="param-type">str</td>
                                <td>Human-readable join logic summary.</td>
                            </tr>
                        </table>
                    </div>

                    <!-- audit() -->
                    <div id="api-audit" class="api-card">
                        <h3 class="text-xl font-mono text-white mt-0">function audit()</h3>
                        <p>Scan a dataset for temporal leakage. Two modes are available.</p>

                        <h4>Mode 1: Rebuild-and-compare (full audit)</h4>
                        <pre><code class="language-python">report = timefence.audit(
    data="data/train.parquet",
    features=[rolling_spend, user_country],
    keys=["user_id"],
    label_time="label_time",
    max_lookback="365d",
    max_staleness=None,
    join="strict",
)</code></pre>

                        <h4>Mode 2: Temporal check (lightweight)</h4>
                        <pre><code class="language-python">report = timefence.audit.temporal(
    data="data/train.parquet",
    feature_time_columns={
        "spend_30d": "spend_computed_at",
        "country": "country_updated_at",
    },
    label_time="label_time",
)</code></pre>

                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">data</td>
                                <td class="param-type">str | Path | Any</td>
                                <td>Dataset to audit (file path or DataFrame).</td>
                            </tr>
                            <tr>
                                <td class="param-name">features</td>
                                <td class="param-type">list[Feature | FeatureSet] | None</td>
                                <td>Feature definitions (Mode 1 only).</td>
                            </tr>
                            <tr>
                                <td class="param-name">keys</td>
                                <td class="param-type">str | list[str] | None</td>
                                <td>Entity key column(s) (Mode 1 only).</td>
                            </tr>
                            <tr>
                                <td class="param-name">label_time</td>
                                <td class="param-type">str | None</td>
                                <td>Label time column name.</td>
                            </tr>
                            <tr>
                                <td class="param-name">feature_time_columns</td>
                                <td class="param-type">dict[str, str] | None</td>
                                <td>Mode 2 only: <code>{feature_name: time_column}</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">max_lookback</td>
                                <td class="param-type">str | timedelta</td>
                                <td>Maximum feature age. Default: <code>"365d"</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">max_staleness</td>
                                <td class="param-type">str | timedelta | None</td>
                                <td>Max feature age before treating as missing. Default: <code>None</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">join</td>
                                <td class="param-type">str</td>
                                <td><code>"strict"</code> (<code>&lt;</code>) or <code>"inclusive"</code> (<code>&lt;=</code>). Default: <code>"strict"</code>.</td>
                            </tr>
                        </table>

                        <h4>Returns: AuditReport</h4>
                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">.has_leakage</td>
                                <td class="param-type">bool</td>
                                <td><code>True</code> if any feature is leaky.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.clean_features</td>
                                <td class="param-type">list[str]</td>
                                <td>Feature names with no leakage.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.leaky_features</td>
                                <td class="param-type">list[str]</td>
                                <td>Feature names with leakage.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.total_rows</td>
                                <td class="param-type">int</td>
                                <td>Total rows scanned.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.mode</td>
                                <td class="param-type">str</td>
                                <td><code>"rebuild"</code> (Mode 1) or <code>"temporal"</code> (Mode 2).</td>
                            </tr>
                            <tr>
                                <td class="param-name">[name]</td>
                                <td class="param-type">FeatureAuditDetail</td>
                                <td>Per-feature detail via <code>report["feature_name"]</code>.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.assert_clean()</td>
                                <td class="param-type">None</td>
                                <td>Raises <code>TimefenceLeakageError</code> if leakage found.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.to_html(path)</td>
                                <td class="param-type">None</td>
                                <td>Export interactive HTML report.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.to_json(path)</td>
                                <td class="param-type">None</td>
                                <td>Export JSON report.</td>
                            </tr>
                        </table>

                        <h4>FeatureAuditDetail fields</h4>
                        <table class="w-full text-sm param-table">
                            <tr><td class="param-name">.clean</td><td class="param-type">bool</td><td>No leakage detected.</td></tr>
                            <tr><td class="param-name">.leaky_row_count</td><td class="param-type">int</td><td>Number of leaky rows.</td></tr>
                            <tr><td class="param-name">.leaky_row_pct</td><td class="param-type">float</td><td>Fraction of rows with leakage (0.0 &ndash; 1.0).</td></tr>
                            <tr><td class="param-name">.severity</td><td class="param-type">str</td><td><code>"HIGH"</code>, <code>"MEDIUM"</code>, <code>"LOW"</code>, or <code>"OK"</code>.</td></tr>
                            <tr><td class="param-name">.max_leakage</td><td class="param-type">timedelta | None</td><td>Largest time violation.</td></tr>
                            <tr><td class="param-name">.median_leakage</td><td class="param-type">timedelta | None</td><td>Median time violation.</td></tr>
                            <tr><td class="param-name">.total_rows</td><td class="param-type">int</td><td>Total rows examined for this feature.</td></tr>
                            <tr><td class="param-name">.null_rows</td><td class="param-type">int</td><td>Rows where the feature value was NULL.</td></tr>
                            <tr><td class="param-name">.leaky_rows</td><td class="param-type">DataFrame | None</td><td>Sample of leaky rows (up to 1,000 rows).</td></tr>
                        </table>

                        <div class="callout-info mt-4">
                            <p class="text-sm text-blue-300"><strong>Severity levels:</strong> HIGH = &gt;5% leaky rows or max leakage &gt;7 days. MEDIUM = 1&ndash;5% or 1&ndash;7 days. LOW = &lt;1% and &lt;1 day. OK = no leakage.</p>
                        </div>
                    </div>

                    <!-- explain() -->
                    <div id="api-explain" class="api-card api-card-blue">
                        <h3 class="text-xl font-mono text-white mt-0">function explain()</h3>
                        <p>Preview the join logic that <code>build()</code> will use, without executing any queries.</p>
                        <pre><code class="language-python">result = timefence.explain(
    labels=labels,
    features=[rolling_spend, user_country],
    max_lookback="365d",
    max_staleness=None,
    join="strict",
)

print(result)  # Human-readable join plan</code></pre>

                        <h4>Returns: ExplainResult</h4>
                        <table class="w-full text-sm param-table">
                            <tr>
                                <td class="param-name">.label_count</td>
                                <td class="param-type">int</td>
                                <td>Number of label rows.</td>
                            </tr>
                            <tr>
                                <td class="param-name">.plan</td>
                                <td class="param-type">list[dict]</td>
                                <td>Per-feature join plan with <code>name</code>, <code>source</code>, <code>join_condition</code>, <code>window</code>, <code>embargo_str</code>, <code>strategy</code>, <code>sql</code>.</td>
                            </tr>
                        </table>
                    </div>

                    <!-- diff() -->
                    <div id="api-diff" class="api-card api-card-blue">
                        <h3 class="text-xl font-mono text-white mt-0">function diff()</h3>
                        <p>Compare two training datasets for schema drift and value changes.</p>
                        <pre><code class="language-python">result = timefence.diff(
    old="train_v1.parquet",
    new="train_v2.parquet",
    keys=["user_id"],
    label_time="label_time",
    atol=1e-10,  # Absolute tolerance for numeric comparison
    rtol=1e-7,   # Relative tolerance for numeric comparison
)</code></pre>

                        <h4>Returns: DiffResult</h4>
                        <table class="w-full text-sm param-table">
                            <tr><td class="param-name">.old_rows</td><td class="param-type">int</td><td>Row count in old dataset.</td></tr>
                            <tr><td class="param-name">.new_rows</td><td class="param-type">int</td><td>Row count in new dataset.</td></tr>
                            <tr><td class="param-name">.schema_changes</td><td class="param-type">list[dict]</td><td>Schema changes: <code>type</code> (<code>+</code>/<code>-</code>/<code>~</code>), <code>column</code>, <code>detail</code>.</td></tr>
                            <tr><td class="param-name">.value_changes</td><td class="param-type">dict[str, dict]</td><td>Per-column: <code>changed_count</code>, <code>changed_pct</code>, <code>mean_delta</code>, <code>max_delta</code>.</td></tr>
                        </table>
                    </div>

                    <!-- Store -->
                    <div id="api-store" class="api-card api-card-blue">
                        <h3 class="text-xl font-mono text-white mt-0">class Store</h3>
                        <p>Local directory for build tracking and caching.</p>
                        <pre><code class="language-python">store = timefence.Store(".timefence")

# Pass to build()
result = timefence.build(labels=labels, features=features, store=store)

# List past builds
builds = store.list_builds()  # Newest first

# Get a specific build
manifest = store.get_build("abc123")</code></pre>
                        <table class="w-full text-sm param-table">
                            <tr><td class="param-name">path</td><td class="param-type">str | Path</td><td>Store directory. Default: <code>".timefence"</code>.</td></tr>
                        </table>
                        <h4>Methods</h4>
                        <table class="w-full text-sm param-table">
                            <tr><td class="param-name">.save_build(manifest)</td><td class="param-type">Path</td><td>Save build manifest, return manifest path.</td></tr>
                            <tr><td class="param-name">.list_builds()</td><td class="param-type">list[dict]</td><td>List all builds (newest first).</td></tr>
                            <tr><td class="param-name">.get_build(build_id)</td><td class="param-type">dict | None</td><td>Get a specific build manifest by ID.</td></tr>
                            <tr><td class="param-name">.content_hash(path)</td><td class="param-type">str</td><td>Compute SHA-256 hash of file.</td></tr>
                        </table>
                    </div>
                </section>

                <hr>

                <!-- ============================================================ -->
                <!-- CLI REFERENCE                                                -->
                <!-- ============================================================ -->

                <section id="cli">
                    <h2 class="border-b border-white/10 pb-2 mb-8">CLI Reference</h2>

                    <!-- Global options -->
                    <div id="cli-global" class="mb-10">
                        <h3>Global Options</h3>
                        <p>These flags apply to all commands when placed before the subcommand name.</p>
                        <pre><code class="language-bash">timefence -v &lt;command&gt;       # Verbose: show generated SQL and build details
timefence --debug &lt;command&gt;  # Debug: full output including DuckDB internals</code></pre>
                        <table class="w-full text-sm mt-4">
                            <thead><tr class="text-left text-slate-400 border-b border-white/10"><th class="pb-2 param-name">Flag</th><th class="pb-2 param-type">Description</th></tr></thead>
                            <tbody class="text-slate-300">
                                <tr class="border-b border-white/5"><td class="py-2 font-mono text-brand-400">-v, --verbose</td><td class="py-2">Show generated SQL, cache status, and label/feature details</td></tr>
                                <tr class="border-b border-white/5"><td class="py-2 font-mono text-brand-400">--debug</td><td class="py-2">Full debug output: ASOF fallback reasons, hash details, DuckDB internals</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- cli: audit -->
                    <div id="cli-audit" class="mb-10">
                        <h3><code>timefence audit</code></h3>
                        <p>Scan a dataset for temporal leakage.</p>
                        <pre><code class="language-bash"># Basic audit
timefence audit data/train.parquet

# With explicit options
timefence audit data/train.parquet \
  --features features.py \
  --keys user_id \
  --label-time label_time

# CI mode: exit code 1 if leakage found
timefence audit data/train.parquet --strict

# Export reports
timefence audit data/train.parquet --html report.html
timefence audit data/train.parquet --json</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">data</td><td>Positional. Path to the dataset file.</td></tr>
                            <tr><td class="param-name">--features</td><td>Path to Python file with feature definitions.</td></tr>
                            <tr><td class="param-name">--keys</td><td>Key column(s), comma-separated.</td></tr>
                            <tr><td class="param-name">--label-time</td><td>Label time column name.</td></tr>
                            <tr><td class="param-name">--strict</td><td>Exit with code 1 if leakage found (for CI/CD).</td></tr>
                            <tr><td class="param-name">--html FILE</td><td>Export interactive HTML report.</td></tr>
                            <tr><td class="param-name">--json</td><td>Output as JSON.</td></tr>
                        </table>
                    </div>

                    <!-- cli: build -->
                    <div id="cli-build" class="mb-10">
                        <h3><code>timefence build</code></h3>
                        <p>Build a point-in-time correct training set. Uses <code>timefence.yaml</code> defaults if available.</p>
                        <pre><code class="language-bash"># Basic build
timefence build \
  --labels data/labels.parquet \
  --features features.py \
  -o train.parquet

# With all options
timefence build \
  --labels data/labels.parquet \
  --features features.py \
  -o train.parquet \
  --max-lookback 365d \
  --max-staleness 30d \
  --on-missing null \
  --join-mode strict

# Time-based splits
timefence build \
  --labels data/labels.parquet \
  --features features.py \
  -o train.parquet \
  --split train:2023-01-01:2024-01-01 \
  --split test:2024-01-01:2025-01-01

# Dry run (preview plan without executing)
timefence build \
  --labels data/labels.parquet \
  --features features.py \
  -o train.parquet \
  --dry-run</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">--labels</td><td>Path to labels file (required unless in config).</td></tr>
                            <tr><td class="param-name">--features</td><td>Path to features Python file (required unless in config).</td></tr>
                            <tr><td class="param-name">-o, --output</td><td>Output path for training set (required).</td></tr>
                            <tr><td class="param-name">--max-lookback</td><td>Maximum lookback window (e.g., <code>"365d"</code>).</td></tr>
                            <tr><td class="param-name">--max-staleness</td><td>Maximum feature staleness.</td></tr>
                            <tr><td class="param-name">--on-missing</td><td><code>null</code> or <code>skip</code>.</td></tr>
                            <tr><td class="param-name">--join-mode</td><td><code>strict</code> or <code>inclusive</code>.</td></tr>
                            <tr><td class="param-name">--split</td><td>Time split: <code>name:start:end</code> (repeatable).</td></tr>
                            <tr><td class="param-name">--dry-run</td><td>Show plan without executing.</td></tr>
                            <tr><td class="param-name">--flatten</td><td>Strip feature name prefix from output columns.</td></tr>
                            <tr><td class="param-name">--json</td><td>Output build manifest as JSON.</td></tr>
                        </table>
                    </div>

                    <!-- cli: explain -->
                    <div id="cli-explain" class="mb-10">
                        <h3><code>timefence explain</code></h3>
                        <p>Preview join logic without executing any queries.</p>
                        <pre><code class="language-bash"># Full explain
timefence explain \
  --labels data/labels.parquet \
  --features features.py

# Single feature
timefence explain --features features.py:rolling_spend_30d

# JSON output
timefence explain --features features.py --json</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">--labels</td><td>Path to labels file.</td></tr>
                            <tr><td class="param-name">--features</td><td>Path to features Python file. Append <code>:name</code> for single feature.</td></tr>
                            <tr><td class="param-name">--max-lookback</td><td>Maximum lookback window.</td></tr>
                            <tr><td class="param-name">--join-mode</td><td><code>strict</code> or <code>inclusive</code>.</td></tr>
                            <tr><td class="param-name">--json</td><td>Output as JSON.</td></tr>
                        </table>
                    </div>

                    <!-- cli: diff -->
                    <div id="cli-diff" class="mb-10">
                        <h3><code>timefence diff</code></h3>
                        <p>Compare two datasets for value changes or schema drift.</p>
                        <pre><code class="language-bash">timefence diff train_v1.parquet train_v2.parquet \
  --keys user_id \
  --label-time label_time

# Custom tolerance
timefence diff v1.parquet v2.parquet \
  --keys user_id \
  --label-time label_time \
  --atol 0.01 \
  --rtol 0.001

# JSON output
timefence diff v1.parquet v2.parquet \
  --keys user_id \
  --label-time label_time \
  --json</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">old_path</td><td>Positional. Path to first dataset.</td></tr>
                            <tr><td class="param-name">new_path</td><td>Positional. Path to second dataset.</td></tr>
                            <tr><td class="param-name">--keys</td><td>Key column(s), comma-separated (required).</td></tr>
                            <tr><td class="param-name">--label-time</td><td>Label time column (required).</td></tr>
                            <tr><td class="param-name">--atol</td><td>Absolute tolerance for numeric comparison (default: <code>1e-10</code>).</td></tr>
                            <tr><td class="param-name">--rtol</td><td>Relative tolerance for numeric comparison (default: <code>1e-7</code>).</td></tr>
                            <tr><td class="param-name">--json</td><td>Output as JSON.</td></tr>
                        </table>
                    </div>

                    <!-- cli: inspect -->
                    <div id="cli-inspect" class="mb-10">
                        <h3><code>timefence inspect</code></h3>
                        <p>Analyze a data file and suggest which columns are keys and timestamps.</p>
                        <pre><code class="language-bash">timefence inspect data/transactions.parquet
timefence inspect data/events.csv --json</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">path</td><td>Positional. Path to data file (Parquet or CSV).</td></tr>
                            <tr><td class="param-name">--json</td><td>Output as JSON.</td></tr>
                        </table>
                        <p class="text-sm text-slate-500 mt-2">Output includes column names, types, uniqueness percentage, and auto-detected key/timestamp suggestions.</p>
                    </div>

                    <!-- cli: quickstart -->
                    <div id="cli-quickstart" class="mb-10">
                        <h3><code>timefence quickstart</code></h3>
                        <p>Generate a self-contained example project with synthetic data and leakage scenarios.</p>
                        <pre><code class="language-bash"># Default churn example
timefence quickstart churn-example

# Minimal version
timefence quickstart myproject --minimal</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">project_name</td><td>Positional. Directory name to create.</td></tr>
                            <tr><td class="param-name">--template</td><td>Example template. Default: <code>"churn"</code>.</td></tr>
                            <tr><td class="param-name">--minimal</td><td>Generate a smaller example.</td></tr>
                        </table>
                    </div>

                    <!-- cli: catalog -->
                    <div id="cli-catalog" class="mb-10">
                        <h3><code>timefence catalog</code></h3>
                        <p>List all features defined in a project.</p>
                        <pre><code class="language-bash">timefence catalog --features features.py
timefence catalog --features features.py --json</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">--features</td><td>Path to features Python file.</td></tr>
                            <tr><td class="param-name">--json</td><td>Output as JSON.</td></tr>
                        </table>
                        <p class="text-sm text-slate-500 mt-2">Output shows Name, Source, Keys, Embargo, and Mode for each feature.</p>
                    </div>

                    <!-- cli: doctor -->
                    <div id="cli-doctor" class="mb-10">
                        <h3><code>timefence doctor</code></h3>
                        <p>Diagnose project setup and common issues.</p>
                        <pre><code class="language-bash">timefence doctor
timefence doctor --json</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">--json</td><td>Output as JSON.</td></tr>
                        </table>
                        <p class="text-sm text-slate-500 mt-2">Checks: config file, DuckDB installation, feature file validity, source file accessibility, label schema compatibility, duplicate keys, and column name conflicts.</p>
                    </div>

                    <!-- cli: init -->
                    <div id="cli-init" class="mb-10">
                        <h3><code>timefence init</code></h3>
                        <p>Initialize a project with a <code>timefence.yaml</code> config file.</p>
                        <pre><code class="language-bash"># Current directory
timefence init

# Specific directory
timefence init my-project/</code></pre>
                        <table class="w-full text-sm param-table mt-4">
                            <tr><td class="param-name">path</td><td>Positional (optional). Directory to create config in. Default: current directory.</td></tr>
                        </table>
                    </div>
                </section>

                <hr>

                <!-- ============================================================ -->
                <!-- REFERENCE                                                    -->
                <!-- ============================================================ -->

                <section id="config">
                    <h2>Configuration (<code>timefence.yaml</code>)</h2>
                    <p>Timefence looks for a <code>timefence.yaml</code> in the current directory. All fields are optional &mdash; CLI flags and Python API arguments take precedence.</p>
                    <pre><code class="language-yaml">name: churn-model
version: "1.0"

# Feature file(s)
features:
  - features.py

# Label configuration
labels:
  path: data/labels.parquet
  keys: [user_id]
  label_time: label_time
  target: [churned]

# Default parameters
defaults:
  max_lookback: 365d
  join: strict          # "strict" or "inclusive"
  on_missing: "null"    # "null" or "skip"

# Store directory for build tracking
store: .timefence/

# Output directory (relative paths in build resolve against this)
output:
  dir: artifacts/</code></pre>
                    <div class="callout-tip mt-4">
                        <p class="text-sm text-green-300"><strong>Precedence:</strong> CLI flags &gt; Python API arguments &gt; <code>timefence.yaml</code> &gt; built-in defaults.</p>
                    </div>
                </section>

                <section id="errors">
                    <h2>Errors</h2>
                    <p>All Timefence errors follow a consistent format: <strong>WHAT</strong> happened, <strong>WHY</strong> it happened, <strong>WHERE</strong> in the data, and <strong>HOW TO FIX</strong> it.</p>

                    <div class="api-card api-card-red mb-4">
                        <h4 class="font-mono text-white mt-0">TimefenceSchemaError</h4>
                        <p class="text-sm">Raised when expected columns are missing or types are mismatched between source, labels, and feature definitions.</p>
                    </div>
                    <div class="api-card api-card-red mb-4">
                        <h4 class="font-mono text-white mt-0">TimefenceDuplicateError</h4>
                        <p class="text-sm">Raised when duplicate <code>(key, timestamp)</code> pairs exist in a source and <code>on_duplicate="error"</code> (default). Includes example rows.</p>
                    </div>
                    <div class="api-card api-card-red mb-4">
                        <h4 class="font-mono text-white mt-0">TimefenceTimezoneError</h4>
                        <p class="text-sm">Raised when mixing timezone-aware and timezone-naive timestamps across sources and labels.</p>
                    </div>
                    <div class="api-card api-card-red mb-4">
                        <h4 class="font-mono text-white mt-0">TimefenceConfigError</h4>
                        <p class="text-sm">Raised for invalid parameter combinations (e.g., <code>max_staleness &gt; max_lookback</code>).</p>
                    </div>
                    <div class="api-card api-card-red mb-4">
                        <h4 class="font-mono text-white mt-0">TimefenceLeakageError</h4>
                        <p class="text-sm">Raised by <code>report.assert_clean()</code> when temporal leakage is detected. Includes a summary of leaky features.</p>
                    </div>
                    <div class="api-card api-card-red mb-4">
                        <h4 class="font-mono text-white mt-0">TimefenceValidationError</h4>
                        <p class="text-sm">Raised for general input validation failures (e.g., providing both <code>path</code> and <code>df</code>).</p>
                    </div>
                </section>

                <section id="durations">
                    <h2>Duration Format</h2>
                    <p>Timefence accepts human-readable duration strings wherever a time duration is expected (<code>embargo</code>, <code>max_lookback</code>, <code>max_staleness</code>).</p>
                    <table class="w-full text-sm">
                        <thead><tr><th class="text-left text-slate-400 pb-2">Format</th><th class="text-left text-slate-400 pb-2">Example</th><th class="text-left text-slate-400 pb-2">Meaning</th></tr></thead>
                        <tbody>
                            <tr><td class="py-1"><code>Nd</code></td><td class="py-1"><code>"30d"</code></td><td class="py-1 text-slate-400">30 days</td></tr>
                            <tr><td class="py-1"><code>Nh</code></td><td class="py-1"><code>"6h"</code></td><td class="py-1 text-slate-400">6 hours</td></tr>
                            <tr><td class="py-1"><code>Nm</code></td><td class="py-1"><code>"30m"</code></td><td class="py-1 text-slate-400">30 minutes</td></tr>
                            <tr><td class="py-1"><code>Ns</code></td><td class="py-1"><code>"15s"</code></td><td class="py-1 text-slate-400">15 seconds</td></tr>
                            <tr><td class="py-1">Combined</td><td class="py-1"><code>"1d12h"</code></td><td class="py-1 text-slate-400">1 day and 12 hours</td></tr>
                            <tr><td class="py-1">Zero</td><td class="py-1"><code>"0d"</code> or <code>"0"</code></td><td class="py-1 text-slate-400">No duration</td></tr>
                        </tbody>
                    </table>
                    <p>You can also pass a Python <code>timedelta</code> object directly in the Python API.</p>
                </section>

                <footer class="mt-20 pt-10 border-t border-white/5 text-center text-slate-600 text-sm">
                    <p>Timefence Documentation. Open Source (MIT). Built for correctness.</p>
                </footer>

            </main>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button id="back-to-top" onclick="window.scrollTo({top:0,behavior:'smooth'})" class="fixed bottom-6 right-6 w-10 h-10 rounded-full bg-white/10 border border-white/10 text-slate-400 hover:text-white hover:bg-white/20 flex items-center justify-center opacity-0 pointer-events-none z-50 transition-all" aria-label="Back to top">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
    </button>

    <script>
        // Active sidebar link tracking
        const sections = document.querySelectorAll('section[id]');
        const sidebarLinks = document.querySelectorAll('.sidebar-link');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    sidebarLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + entry.target.id) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, { rootMargin: '-80px 0px -80% 0px' });

        sections.forEach(section => observer.observe(section));

        // Back to top button
        window.addEventListener('scroll', () => {
            const btn = document.getElementById('back-to-top');
            if (window.scrollY > 400) {
                btn.classList.remove('opacity-0', 'pointer-events-none');
                btn.classList.add('opacity-100');
            } else {
                btn.classList.add('opacity-0', 'pointer-events-none');
                btn.classList.remove('opacity-100');
            }
        });

        // Copy buttons for code blocks
        document.querySelectorAll('pre').forEach(pre => {
            const btn = document.createElement('button');
            btn.className = 'copy-btn';
            btn.textContent = 'Copy';
            btn.addEventListener('click', () => {
                const code = pre.querySelector('code');
                navigator.clipboard.writeText(code.textContent);
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(btn);
        });

        // Clone desktop nav into mobile nav
        document.getElementById('mobile-nav').innerHTML = document.getElementById('desktop-nav').innerHTML;
        // Close mobile sidebar on link click
        document.querySelectorAll('#mobile-sidebar .sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('mobile-sidebar').classList.add('hidden');
            });
        });
    </script>

</body>
</html>
